<!DOCTYPE html>
<html>

<head>
    <meta charset="utf-8">
    <title>制作唱词 - 心灵的孤僻</title>
    <!-- Import style -->
    <link rel="stylesheet" href="./css/changci.css" />
    <link rel="stylesheet" href="https://unpkg.com/element-plus@1.1.0-beta.24/dist/index.css" />
    <style>
        .el-textarea.is-disabled .el-textarea__inner {
            background-color: rgb(18, 18, 18);
        }
    </style>
</head>

<body>
    <header></header>
    <main>
        <div id="loading">
            <div>
                <div class="loading">
                    <span></span>
                    <span></span>
                    <span></span>
                    <span></span>
                    <span></span>
                </div>
                <div class="text">正在加载...</div>
            </div>
        </div>
        <div id="formApp" style="display: none;">
            <el-form ref="elForm" :model="formData" :rules="rules" size="medium" label-width="100px">
                <el-row>
                    <el-col :span="8">
                        <el-form-item label="剧种" prop="jz">
                            <el-select v-model="formData.jz" placeholder="请选择剧种" clearable :style="{width: '100%'}">
                                <el-option v-for="(item, index) in jzOptions" :key="index" :label="item.label"
                                    :value="item.value" :disabled="item.disabled"></el-option>
                            </el-select>
                        </el-form-item>
                    </el-col>
                    <el-col :span="8">
                        <el-form-item label="剧目" prop="jm">
                            <el-input v-model="formData.jm" placeholder="请输入剧目" show-word-limit clearable
                                :style="{width: '100%'}"></el-input>
                        </el-form-item>
                    </el-col>
                    <el-col :span="8">
                        <el-form-item label="时差" prop="offset">
                            <el-input-number v-model="formData.offset" placeholder="请输入时差" :step='1'>
                            </el-input-number>
                            <el-tooltip content="主要用于提前或延后显示唱词，单位：s" placement="bottom">
                                <i class="el-icon" style="--font-size:20px;cursor: pointer;vertical-align: middle;"><svg
                                        xmlns="http://www.w3.org/2000/svg" viewBox="0 0 1024 1024">
                                        <path fill="currentColor"
                                            d="M512 64a448 448 0 1 1 0 896 448 448 0 0 1 0-896zm23.744 191.488c-52.096 0-92.928 14.784-123.2 44.352-30.976 29.568-45.76 70.4-45.76 122.496h80.256c0-29.568 5.632-52.8 17.6-68.992 13.376-19.712 35.2-28.864 66.176-28.864 23.936 0 42.944 6.336 56.32 19.712 12.672 13.376 19.712 31.68 19.712 54.912 0 17.6-6.336 34.496-19.008 49.984l-8.448 9.856c-45.76 40.832-73.216 70.4-82.368 89.408-9.856 19.008-14.08 42.24-14.08 68.992v9.856h80.96v-9.856c0-16.896 3.52-31.68 10.56-45.76 6.336-12.672 15.488-24.64 28.16-35.2 33.792-29.568 54.208-48.576 60.544-55.616 16.896-22.528 26.048-51.392 26.048-86.592 0-42.944-14.08-76.736-42.24-101.376-28.16-25.344-65.472-37.312-111.232-37.312zm-12.672 406.208a54.272 54.272 0 0 0-38.72 14.784 49.408 49.408 0 0 0-15.488 38.016c0 15.488 4.928 28.16 15.488 38.016A54.848 54.848 0 0 0 523.072 768c15.488 0 28.16-4.928 38.72-14.784a51.52 51.52 0 0 0 16.192-38.72 51.968 51.968 0 0 0-15.488-38.016 55.936 55.936 0 0 0-39.424-14.784z">
                                        </path>
                                    </svg></i>
                            </el-tooltip>
                        </el-form-item>
                    </el-col>
                    <el-col :span="24">
                        <el-form-item label="选段" prop="ti">
                            <el-input v-model="formData.ti" placeholder="请输入选段" clearable :style="{width: '100%'}">
                            </el-input>
                        </el-form-item>
                    </el-col>
                </el-row>
                <el-row>
                    <el-col :span="12">
                        <el-form-item label="唱词列表" prop="content" :style="{width: '100%'}">
                            <el-input v-model="formData.content" @paste="handlePaste" type="textarea"
                                placeholder="请输入或复制唱词" :autosize=" { minRows: 10, maxRows: 25 }"
                                :style="{width: '100%'}"></el-input>
                        </el-form-item>
                    </el-col>
                    <el-col :span="12">
                        <el-form-item label="LRC列表" :style="{width: '100%'}">
                            <el-input v-model="lrc" disabled type="textarea" placeholder="RLC"
                                :autosize=" { minRows: 10, maxRows: 25 }" :style="{width: '100%'}"></el-input>
                        </el-form-item>
                    </el-col>
                </el-row>
                <el-row>
                    <el-col :span="12">
                        <el-form-item size="large">
                            <el-button @click="resetForm">重置</el-button>
                        </el-form-item>
                    </el-col>
                    <el-col :span="12">
                        <el-form-item size="large">
                            <el-button type="primary" @click="submitForm">复制LRC</el-button>
                        </el-form-item>
                    </el-col>
                    </el-form-item>
                </el-row>
            </el-form>
            <div style="margin-left: 100px;">
                <h3>解释时差</h3>
                <p>由于直播时有网络延时，一般需要提前发送字幕，时差主要用于提前或延后显示唱词，单位：s</p>
                <p>&gt;0 ：表示延后</p>
                <p>&lt;0 ：表示提前</p>
            </div>
        </div>
    </main>
    <footer></footer>
</body>
<!-- Import Vue 3 -->
<script src="https://unpkg.com/vue@3.2.20/dist/vue.global.js"></script>
<!-- Import component library -->
<script src="https://unpkg.com/element-plus@1.1.0-beta.24/dist/index.full.js"></script>
<script src="https://unpkg.com/clipboard@2/dist/clipboard.min.js"></script>
<script src="./js//useClipboard.js"></script>
<script>
    let formApp = {
        components: {},
        props: [],
        data() {
            return {
                formData: {
                    jz: "黄梅戏",
                    jm: '',
                    offset: -10,
                    ti: '',
                    content: "",
                    result: '',
                },
                show: true,
                rules: {
                    jz: [{
                        required: true,
                        message: '请选择剧种',
                        trigger: 'change'
                    }],
                    jm: [{
                        required: true,
                        message: '请输入剧目',
                        trigger: 'blur'
                    }],
                    offset: [{
                        required: true,
                        message: '请输入时差',
                        trigger: 'blur'
                    }],
                    ti: [{
                        required: true,
                        message: '请输入选段',
                        trigger: 'blur'
                    }],
                    content: [{
                        required: true,
                        message: '请输入或复制唱词',
                        trigger: 'blur'
                    }],
                },
                jzOptions: [{
                    "label": "黄梅戏",
                    "value": "黄梅戏"
                }, {
                    "label": "越剧",
                    "value": "越剧"
                }, {
                    "label": "京剧",
                    "value": "京剧"
                }, {
                    "label": "歌曲",
                    "value": "gequ"
                }, {
                    "label": "其他",
                    "value": "其他"
                }],
            }
        },
        computed: {
            lrc() {
                return [
                    "[ti:" + this.formData.ti + "]",
                    "[jz:" + this.formData.jz + "]",
                    "[jm:" + this.formData.jm + "]",
                    "[offset:" + this.formData.offset + "]",
                    this.formData.content
                ].join('\n');
            },
        },
        watch: {},
        created() { },
        mounted() {
            document.getElementById('loading').style.display = 'none';
            document.getElementById('formApp').style.display = 'block';
        },
        methods: {

            getTime(time, i) {
                time *= i;
                let minute = parseInt(time / 60000);
                let second = parseInt((time % 60000) / 1000);
                let millis = time % 1000;
                return "[" + (minute < 10 && "0" + minute || minute) + ":" + (second < 10 && "0" + second || second) + "." + (millis < 10 && "0" + millis || millis) + "]";
            },
            handlePaste(event) {
                let paste = (event.clipboardData || window.clipboardData).getData('text');
                if (paste && paste.trim()) {
                    let list = paste.split('\n').filter(value => value.trim());
                    let time = 7 * 1000;
                    for (let i = 0; i < list.length; i++) {
                        const element = list[i];
                        list[i] = this.getTime(time, i + 1) + list[i];
                    }
                    this.formData.content = list.join('\n');
                }
                event.preventDefault();
            },
            async copy() {
                try {
                    await useClipboard().toClipboard(this.lrc);
                    ElMessage({
                        message: '复制成功',
                        type: 'success',
                    })
                } catch (e) {
                    console.error(e);
                    ElMessage({
                        message: '复制失败' + e.message,
                        type: 'error',
                    })
                }
            },
            submitForm() {
                this.$refs['elForm'].validate(valid => {
                    if (!valid) return;
                    this.copy();
                })
            },
            resetForm() {
                this.$refs['elForm'].resetFields()
            }
        }
    }
    Vue.createApp(formApp).use(ElementPlus).mount('#formApp');
</script>

</html>