<!DOCTYPE html>
<html>

<head>
    <meta charset="utf-8">
    <title>制作唱词 - 心灵的孤僻</title>
    <!-- Import style -->
    <link rel="stylesheet" href="https://unpkg.com/element-plus@1.1.0-beta.24/dist/index.css" />
    <style>
        .el-textarea.is-disabled .el-textarea__inner {
            background-color: rgb(18, 18, 18);
        }
    </style>
</head>

<body>
    <header></header>
    <main>
        <div id="formApp">
            <el-form ref="elForm" :model="formData" :rules="rules" size="medium" label-width="100px">
                <el-row>
                    <el-col :span="8">
                        <el-form-item label="剧种" prop="jz">
                            <el-select v-model="formData.jz" placeholder="请选择剧种" clearable :style="{width: '100%'}">
                                <el-option v-for="(item, index) in jzOptions" :key="index" :label="item.label"
                                    :value="item.value" :disabled="item.disabled"></el-option>
                            </el-select>
                        </el-form-item>
                    </el-col>
                    <el-col :span="8">
                        <el-form-item label="剧目" prop="jm">
                            <el-input v-model="formData.jm" placeholder="请输入剧目" show-word-limit clearable
                                :style="{width: '100%'}"></el-input>
                        </el-form-item>
                    </el-col>
                    <el-col :span="8">
                        <el-form-item label="时差" prop="offset">
                            <el-input-number v-model="formData.offset" placeholder="请输入时差" :step='1'>
                            </el-input-number>
                        </el-form-item>
                    </el-col>
                    <el-col :span="24">
                        <el-form-item label="选段" prop="ti">
                            <el-input v-model="formData.ti" placeholder="请输入选段" clearable :style="{width: '100%'}">
                            </el-input>
                        </el-form-item>
                    </el-col>
                </el-row>
                <el-row>
                    <el-col :span="12">
                        <el-form-item label="唱词列表" prop="content" :style="{width: '100%'}">
                            <el-input v-model="formData.content" @paste="handlePaste" type="textarea"
                                placeholder="请输入或复制唱词" :autosize=" { minRows: 10, maxRows: 25 }"
                                :style="{width: '100%'}"></el-input>
                        </el-form-item>
                    </el-col>
                    <el-col :span="12">
                        <el-form-item label="LRC列表" :style="{width: '100%'}">
                            <el-input v-model="lrc" disabled type="textarea" placeholder="RLC"
                                :autosize=" { minRows: 10, maxRows: 25 }" :style="{width: '100%'}"></el-input>
                        </el-form-item>
                    </el-col>
                </el-row>
                <el-form-item size="large">
                    <el-button type="primary" @click="submitForm">提交</el-button>
                    <el-button @click="resetForm">重置</el-button>
                </el-form-item>
            </el-form>
        </div>
        <p><small>解释时差：主要用于提前或延后显示唱词，单位：s</small></p>
    </main>
    <footer></footer>
</body>
<!-- Import Vue 3 -->
<script src="https://unpkg.com/vue@3.2.20/dist/vue.global.js"></script>
<!-- Import component library -->
<script src="https://unpkg.com/element-plus@1.1.0-beta.24/dist/index.full.js"></script>
<script src="https://unpkg.com/clipboard@2/dist/clipboard.min.js"></script>
<script src="./js//useClipboard.js"></script>
<script>
    let formApp = {
        components: {},
        props: [],
        data() {
            return {
                formData: {
                    jz: "黄梅戏",
                    jm: '',
                    offset: -10,
                    ti: '',
                    content: "",
                    result: '',
                },
                rules: {
                    jz: [{
                        required: true,
                        message: '请选择剧种',
                        trigger: 'change'
                    }],
                    jm: [{
                        required: true,
                        message: '请输入剧目',
                        trigger: 'blur'
                    }],
                    offset: [{
                        required: true,
                        message: '请输入时差',
                        trigger: 'blur'
                    }],
                    ti: [{
                        required: true,
                        message: '请输入选段',
                        trigger: 'blur'
                    }],
                    content: [{
                        required: true,
                        message: '请输入或复制唱词',
                        trigger: 'blur'
                    }],
                },
                jzOptions: [{
                    "label": "黄梅戏",
                    "value": "黄梅戏"
                }, {
                    "label": "越剧",
                    "value": "越剧"
                }, {
                    "label": "京剧",
                    "value": "京剧"
                }, {
                    "label": "歌曲",
                    "value": "gequ"
                }, {
                    "label": "其他",
                    "value": "其他"
                }],
            }
        },
        computed: {
            lrc() {
                return [
                    "[ti:" + this.formData.ti + "]",
                    "[jz:" + this.formData.jz + "]",
                    "[jm:" + this.formData.jm + "]",
                    "[offset:" + this.formData.offset + "]",
                    this.formData.content
                ].join('\n');
            },
        },
        watch: {},
        created() { },
        mounted() { },
        methods: {

            getTime(time, i) {
                time *= i;
                let minute = parseInt(time / 60000);
                let second = parseInt((time % 60000) / 1000);
                let millis = time % 1000;
                return "[" + (minute < 10 && "0" + minute || minute) + ":" + (second < 10 && "0" + second || second) + "." + (millis < 10 && "0" + millis || millis) + "]";
            },
            handlePaste(event) {
                let paste = (event.clipboardData || window.clipboardData).getData('text');
                if (paste && paste.trim()) {
                    let list = paste.split('\n').filter(value => value.trim());
                    let time = 7 * 1000;
                    for (let i = 0; i < list.length; i++) {
                        const element = list[i];
                        list[i] = this.getTime(time, i + 1) + list[i];
                    }
                    this.formData.content = list.join('\n');
                }
                event.preventDefault();
            },
            async copy() {
                try {
                    await useClipboard().toClipboard(this.lrc);
                    ElMessage({
                        message: '复制成功',
                        type: 'success',
                    })
                } catch (e) {
                    console.error(e);
                    ElMessage({
                        message: '复制失败' + e.message,
                        type: 'error',
                    })
                }
            },
            submitForm() {
                this.$refs['elForm'].validate(valid => {
                    if (!valid) return;
                    this.copy();
                })
            },
            resetForm() {
                this.$refs['elForm'].resetFields()
            }
        }
    }
    Vue.createApp(formApp).use(ElementPlus).mount('#formApp');
</script>

</html>